<!doctype html>
<html lang="en" data-lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>WCWD — World Chain / WLD Dashboard</title>
  <meta name="description" content="World Chain quick dashboard: server-observed history (Workers Cron + KV) + Phase 0 best-effort metrics." />

  <!-- ✅ History Worker base (frontend fetches from here) -->
  <meta name="wcwd-history-base" content="https://wcwd-history.badjoke-lab.workers.dev" />

  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <main class="wrap">
    <header class="hero">
      <h1>WCWD — World Chain / WLD Dashboard</h1>

      <p class="lead">Phase 0: RPC + optional APIs (Etherscan / CoinGecko). No indexer. No wallet connect.</p>
      <p class="lead">✅ History: Cloudflare Workers Cron + KV (server-side sampling, interval from worker, default ~15 min).</p>

      <div class="actions">
        <button id="reload" type="button">Reload</button>
        <div class="status">Status: <strong id="status">—</strong></div>
      </div>

      <p class="muted">
        This dashboard provides “best-effort” signals. Some metrics are unavailable without an indexer.
      </p>
    </header>

    <section class="card">
      <h2>Health</h2>
      <div class="grid">
        <div class="metric">
          <div class="k">Status</div>
          <div class="v" id="healthLevel">—</div>
        </div>
        <div class="metric">
          <div class="k">Reasons</div>
          <div class="v mono" id="healthReasons">—</div>
        </div>
        <div class="metric">
          <div class="k">Baseline</div>
          <div class="v mono" id="healthBaseline">—</div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Network</h2>
      <div class="grid">
        <div class="metric">
          <div class="k">TPS (est.)</div>
          <div class="v" id="tps">—</div>
        </div>

        <div class="metric">
          <div class="k">Tx/day (est.)</div>
          <div class="v" id="tx24h">—</div>
        </div>

        <div class="metric">
          <div class="k">Gas Price (gwei)</div>
          <div class="v" id="gasPrice">—</div>
        </div>

        <div class="metric">
          <div class="k">New addresses (24h)</div>
          <div class="v" id="newAddr24h">N/A</div>
          <div class="n" id="newAddrNote">History-only: no indexer.</div>
        </div>

        <div class="metric">
          <div class="k">Total addresses</div>
          <div class="v" id="totalAddr">N/A</div>
          <div class="n" id="totalAddrNote">History-only: no indexer.</div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>WLD Market (CoinGecko)</h2>
      <div class="grid">
        <div class="metric">
          <div class="k">WLD (USD)</div>
          <div class="v" id="wldUsd">—</div>
        </div>

        <div class="metric">
          <div class="k">WLD (JPY)</div>
          <div class="v" id="wldJpy">—</div>
        </div>

        <div class="metric">
          <div class="k">24h change</div>
          <div class="v" id="wldChg24h">—</div>
          <div class="n" id="cgNote">Local mode: /api/summary unavailable (static). Showing history-only signals.</div>
        </div>

        <div class="metric">
          <div class="k">Market cap</div>
          <div class="v" id="wldMc">—</div>
        </div>

        <div class="metric">
          <div class="k">24h volume</div>
          <div class="v" id="wldVol">—</div>
        </div>

        <div class="metric">
          <div class="k">Sparkline (7d)</div>
          <div class="v mono" id="wldSpark7d">—</div>
        </div>
      </div>

      <div class="mini">
        <div class="k">WLD 7d (sparkline)</div>
        <div class="v mono" id="chartWld7d">—</div>
      </div>
    </section>

    <section class="card">
      <h2>Activity (latest block sample)</h2>
      <p class="muted">Approximation based on server sampling (no indexer).</p>

      <div class="grid">
        <div class="metric">
          <div class="k">Token-tx share (approx)</div>
          <div class="v" id="pctToken">—</div>
        </div>

        <div class="metric">
          <div class="k">Non-token share (approx)</div>
          <div class="v" id="pctNative">—</div>
        </div>

        <div class="metric">
          <div class="k">Contract share</div>
          <div class="v" id="pctContract">—</div>
        </div>

        <div class="metric">
          <div class="k">Other share</div>
          <div class="v" id="pctOther">—</div>
        </div>
      </div>

      <div class="note" id="actNote">Local mode: activity sample is from server history only.</div>
    </section>

    <section class="card">
      <h2>Trends (server observed)</h2>
      <p class="muted">
        These trends come from Workers Cron sampling and KV storage (not “who viewed the page”).
        Interval is reported by the history worker (default ~15 minutes). (1 day ≈ 96 points @ 15 min)
      </p>

      <div class="mini">
        <div class="k">TPS (24h)</div>
        <canvas id="sparkTps" width="720" height="48" style="width:100%;height:48px;border-radius:10px;background:#fff;"></canvas>
      </div>

      <div class="mini">
        <div class="k">Gas (24h, gwei)</div>
        <canvas id="sparkGas" width="720" height="48" style="width:100%;height:48px;border-radius:10px;background:#fff;"></canvas>
      </div>

      <div class="mini">
        <div class="k">WLD USD (24h)</div>
        <canvas id="sparkWld" width="720" height="48" style="width:100%;height:48px;border-radius:10px;background:#fff;"></canvas>
      </div>

      <div class="mini">
        <div class="k">Token-tx share (24h, approx)</div>
        <canvas id="sparkToken" width="720" height="48" style="width:100%;height:48px;border-radius:10px;background:#fff;"></canvas>
      </div>

      <div class="note" id="noteHistory">—</div>
    </section>

    <section class="card" id="ecosystem">
      <h2>Ecosystem</h2>
      <p class="muted">World Chain tokens, dApps, infra, and oracles curated in ecosystem.json.</p>
      <div class="eco-legend">
        <span class="eco-legend-item eco-verified">✅ Verified on World Chain</span>
        <span class="eco-legend-item eco-offchain">⚪ Offchain (World official)</span>
        <span class="eco-legend-item eco-unverified">⚠ Unverified / Cross-chain</span>
      </div>

      <div class="eco-hot">
        <div class="eco-hot-head">
          <h3>Hot</h3>
          <div class="note">Top 5 items with hot=true (sorted by hot_rank).</div>
        </div>
        <div id="ecoHotList" class="eco-hot-list"></div>
        <div class="note" id="ecoHotEmpty">No hot items yet</div>
      </div>

      <div class="eco-new">
        <div class="eco-hot-head">
          <h3>New</h3>
          <div class="note">Newest additions by added_at.</div>
        </div>
        <div id="ecoNewList" class="eco-hot-list"></div>
        <div class="note" id="ecoNewEmpty">No new items yet</div>
      </div>

      <div class="eco-filters">
        <div class="tabs" role="tablist" aria-label="Ecosystem types">
          <button class="tab-btn active" type="button" data-eco-type="all">All</button>
          <button class="tab-btn" type="button" data-eco-type="token">Tokens</button>
          <button class="tab-btn" type="button" data-eco-type="dapp">dApps</button>
          <button class="tab-btn" type="button" data-eco-type="infra">Infra</button>
          <button class="tab-btn" type="button" data-eco-type="oracle">Oracles</button>
        </div>
        <div class="eco-inputs">
          <input id="ecoSearch" type="search" placeholder="Search by name, symbol, tag, description" />
          <select id="ecoCategory"></select>
          <label class="eco-toggle">
            <input id="ecoShowUnverified" type="checkbox" />
            Show unverified/cross-chain
          </label>
        </div>
        <div class="note" id="ecoTagState">Tag filter: none</div>
      </div>

      <div class="note error" id="ecoError" role="alert"></div>
      <div id="ecoList" class="eco-list"></div>
      <div class="note" id="ecoEmpty">No items match the filters.</div>

      <div class="eco-pr">
        <h3>Add via PR</h3>
        <p class="muted">
          1. Edit ecosystem.json and add your project entry. 2. Open a PR with a short description.
          3. Once merged, it appears here automatically.
        </p>
        <p class="note">World Chain (chainId=480) entries are shown by default. Cross-chain items require the toggle.</p>
        <p>
          <a href="https://github.com/badjoke-lab/wcwd/blob/main/ecosystem.json" target="_blank" rel="noopener">Edit ecosystem.json on GitHub</a>
        </p>
      </div>
    </section>

    <section class="card">
      <h2>7d Series (history)</h2>
      <p class="muted">
        7d charts come from the History Worker series API (hourly avg, UTC buckets).
      </p>

      <div class="mini">
        <div class="k">TPS (7d, 1h avg)</div>
        <canvas id="seriesTps7d" width="720" height="56" style="width:100%;height:56px;border-radius:10px;background:#fff;"></canvas>
        <div class="note mono" id="noteSeriesTps7d">—</div>
      </div>

      <div class="mini">
        <div class="k">WLD USD (7d, 1h avg)</div>
        <canvas id="seriesWld7d" width="720" height="56" style="width:100%;height:56px;border-radius:10px;background:#fff;"></canvas>
        <div class="note mono" id="noteSeriesWld7d">—</div>
      </div>
    </section>

    <section class="card">
      <h2>Alerts (vs recent average)</h2>
      <p class="muted">Alerts compare the latest value vs the average of recent history points (server-side KV samples).</p>

      <div class="grid">
        <div class="metric">
          <div class="k">Spike (TPS)</div>
          <div class="v" id="alertSpike">—</div>
        </div>
        <div class="metric">
          <div class="k">Drop (TPS)</div>
          <div class="v" id="alertDrop">—</div>
        </div>
        <div class="metric">
          <div class="k">High Gas</div>
          <div class="v" id="alertHighGas">—</div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Events</h2>
      <div id="eventsList">—</div>
    </section>

    <section class="card">
      <h2>Daily</h2>
      <div class="grid">
        <div class="metric">
          <div class="k">Date</div>
          <div class="v" id="dailyDate">—</div>
        </div>
        <div class="metric">
          <div class="k">Health (mode)</div>
          <div class="v mono" id="dailyHealth">—</div>
        </div>
        <div class="metric">
          <div class="k">TPS max</div>
          <div class="v" id="dailyTpsMax">—</div>
        </div>
        <div class="metric">
          <div class="k">TPS min</div>
          <div class="v" id="dailyTpsMin">—</div>
        </div>
        <div class="metric">
          <div class="k">Gas max (gwei)</div>
          <div class="v" id="dailyGasMax">—</div>
        </div>
        <div class="metric">
          <div class="k">WLD change (USD)</div>
          <div class="v" id="dailyWldUsdChange">—</div>
        </div>
        <div class="metric">
          <div class="k">WLD change (JPY)</div>
          <div class="v" id="dailyWldJpyChange">—</div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Debug</h2>

      <details>
        <summary>Show API response</summary>
        <pre id="raw">—</pre>
      </details>

      <details>
        <summary>Errors</summary>
        <pre id="errors">—</pre>
      </details>

      <p class="muted">
        Phase 0 limitations: no indexer, no historical chain-wide breakdown. Token share is “sample-based token-tx share (approx)”.
      </p>
    </section>
  </main>

  
<footer class="footer">
  <div class="container">
    <p class="muted">WCWD is best-effort. Not financial advice.</p>
    <p class="muted"><a href="https://github.com/badjoke-lab/wcwd" target="_blank" rel="noopener">GitHub</a></p>
  </div>
</footer>
<script src="./app.js" defer></script>
</body>
</html>
