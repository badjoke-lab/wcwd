<!doctype html>
<html lang="en" data-lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>WCWD — World Chain / WLD Dashboard</title>
  <meta name="description" content="World Chain quick dashboard: server-observed history (Workers Cron + KV) + Phase 0 best-effort metrics." />

  <!-- ✅ History Worker base (frontend fetches from here) -->
  <meta name="wcwd-history-base" content="https://wcwd-history.badjoke-lab.workers.dev" />

  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <main class="wrap">
    <header class="hero">
      <h1>WCWD — World Chain / WLD Dashboard</h1>

      <p class="lead">Phase 0: RPC + optional APIs (Etherscan / CoinGecko). No indexer. No wallet connect.</p>
      <p class="lead">✅ History: Cloudflare Workers Cron + KV (server-side sampling, interval from worker, default ~15 min).</p>

      <div class="actions">
        <button id="reload" type="button">Reload</button>
        <div class="status">Status: <strong id="status">—</strong></div>
      </div>

      <p class="muted">
        This dashboard provides “best-effort” signals. Some metrics are unavailable without an indexer.
      </p>
    </header>

    <section class="card">
      <h2>Network</h2>
      <div class="grid">
        <div class="metric">
          <div class="k">TPS (est.)</div>
          <div class="v" id="tps">—</div>
        </div>

        <div class="metric">
          <div class="k">Tx/day (est.)</div>
          <div class="v" id="tx24h">—</div>
        </div>

        <div class="metric">
          <div class="k">Gas Price (gwei)</div>
          <div class="v" id="gasPrice">—</div>
        </div>

        <div class="metric">
          <div class="k">New addresses (24h)</div>
          <div class="v" id="newAddr24h">N/A</div>
          <div class="n" id="newAddrNote">History-only: no indexer.</div>
        </div>

        <div class="metric">
          <div class="k">Total addresses</div>
          <div class="v" id="totalAddr">N/A</div>
          <div class="n" id="totalAddrNote">History-only: no indexer.</div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>WLD Market (CoinGecko)</h2>
      <div class="grid">
        <div class="metric">
          <div class="k">WLD (USD)</div>
          <div class="v" id="wldUsd">—</div>
        </div>

        <div class="metric">
          <div class="k">WLD (JPY)</div>
          <div class="v" id="wldJpy">—</div>
        </div>

        <div class="metric">
          <div class="k">24h change</div>
          <div class="v" id="wldChg24h">—</div>
          <div class="n" id="cgNote">Local mode: /api/summary unavailable (static). Showing history-only signals.</div>
        </div>

        <div class="metric">
          <div class="k">Market cap</div>
          <div class="v" id="wldMc">—</div>
        </div>

        <div class="metric">
          <div class="k">24h volume</div>
          <div class="v" id="wldVol">—</div>
        </div>

        <div class="metric">
          <div class="k">Sparkline (7d)</div>
          <div class="v mono" id="wldSpark7d">—</div>
        </div>
      </div>

      <div class="mini">
        <div class="k">WLD 7d (sparkline)</div>
        <div class="v mono" id="chartWld7d">—</div>
      </div>
    </section>

    <section class="card">
      <h2>Activity (latest block sample)</h2>
      <p class="muted">Approximation based on server sampling (no indexer).</p>

      <div class="grid">
        <div class="metric">
          <div class="k">Token-tx share (approx)</div>
          <div class="v" id="pctToken">—</div>
        </div>

        <div class="metric">
          <div class="k">Non-token share (approx)</div>
          <div class="v" id="pctNative">—</div>
        </div>

        <div class="metric">
          <div class="k">Contract share</div>
          <div class="v" id="pctContract">—</div>
        </div>

        <div class="metric">
          <div class="k">Other share</div>
          <div class="v" id="pctOther">—</div>
        </div>
      </div>

      <div class="note" id="actNote">Local mode: activity sample is from server history only.</div>
    </section>

    <section class="card">
      <h2>Trends (server observed)</h2>
      <p class="muted">
        These trends come from Workers Cron sampling and KV storage (not “who viewed the page”).
        Interval is reported by the history worker (default ~15 minutes). (1 day ≈ 96 points @ 15 min)
      </p>

      <div class="mini">
        <div class="k">TPS (24h)</div>
        <canvas id="sparkTps" width="720" height="48" style="width:100%;height:48px;border-radius:10px;background:#fff;"></canvas>
      </div>

      <div class="mini">
        <div class="k">Gas (24h, gwei)</div>
        <canvas id="sparkGas" width="720" height="48" style="width:100%;height:48px;border-radius:10px;background:#fff;"></canvas>
      </div>

      <div class="mini">
        <div class="k">WLD USD (24h)</div>
        <canvas id="sparkWld" width="720" height="48" style="width:100%;height:48px;border-radius:10px;background:#fff;"></canvas>
      </div>

      <div class="mini">
        <div class="k">Token-tx share (24h, approx)</div>
        <canvas id="sparkToken" width="720" height="48" style="width:100%;height:48px;border-radius:10px;background:#fff;"></canvas>
      </div>

      <div class="note" id="noteHistory">—</div>
    </section>

    <section class="card">
      <h2>7d Series (history)</h2>
      <p class="muted">
        7d charts come from the History Worker series API (hourly avg, UTC buckets).
      </p>

      <div class="mini">
        <div class="k">TPS (7d, 1h avg)</div>
        <canvas id="seriesTps7d" width="720" height="56" style="width:100%;height:56px;border-radius:10px;background:#fff;"></canvas>
        <div class="note mono" id="noteSeriesTps7d">—</div>
      </div>

      <div class="mini">
        <div class="k">WLD USD (7d, 1h avg)</div>
        <canvas id="seriesWld7d" width="720" height="56" style="width:100%;height:56px;border-radius:10px;background:#fff;"></canvas>
        <div class="note mono" id="noteSeriesWld7d">—</div>
      </div>
    </section>

    <section class="card">
      <h2>Alerts (vs recent average)</h2>
      <p class="muted">Alerts compare the latest value vs the average of recent history points (server-side KV samples).</p>

      <div class="grid">
        <div class="metric">
          <div class="k">Spike (TPS)</div>
          <div class="v" id="alertSpike">—</div>
        </div>
        <div class="metric">
          <div class="k">Drop (TPS)</div>
          <div class="v" id="alertDrop">—</div>
        </div>
        <div class="metric">
          <div class="k">High Gas</div>
          <div class="v" id="alertHighGas">—</div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Debug</h2>

      <details>
        <summary>Show API response</summary>
        <pre id="raw">—</pre>
      </details>

      <details>
        <summary>Errors</summary>
        <pre id="errors">—</pre>
      </details>

      <p class="muted">
        Phase 0 limitations: no indexer, no historical chain-wide breakdown. Token share is “sample-based token-tx share (approx)”.
      </p>
    </section>
  </main>

  <script src="./app.js" defer></script>
</body>
</html>
